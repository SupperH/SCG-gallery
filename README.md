
# 1. 项目初始化
工具包：
- mybatisPlus
- hutool
- knife4j 自动生成接口文档   访问： http://localhost:9999/api/doc.html

**项目基础代码** 
请求响应体封装

    封装前端传参和后端返回参数的实体类，便于传输数据  
    com.scg.scgpicturebackend.common

异常封装 

    封装异常类，便于处理异常自定义错误码，对错误进行收敛，便于前端统一处理
    定义全局异常处理器
    com.scg.scgpicturebackend.exception

**解决跨域**

只在浏览器出现，是浏览器的同源策略，如果发送请求的网址和接收请求的网址是相同的 否则就会有跨域问题

 解决跨域问题的方法：

    1.后端来支持跨域
    2.代理 nginx 第三方工具等方法
    3.直接用croscheck注解
    4.全局跨域配置 com.scg.scgpicturebackend.config.CorsConfig


# 2. 用户模块
注册，登录，获取当前登录用户，注销，权限控制，用户管理

使用mybatisX插件生成实体类等代码 

- 定义user表的枚举类
- 定义请求接受类和请求封装类 dto
- 设置要返回给前端哪些数据（脱敏） vo
- 权限控制 配合aop和注解类实现 authInterceptor+AuthCheck
- 分页 使用mybatisplus分页 
-  **天坑： 3.5.9的mybatisplus要额外安装分页插件和配置一个配置类**
-  **天坑： 要注意 前端和后端的long精度不一样 如果直接传的话可能会丢失精度 因为这里的user id是assign_id策略 生成的long比较大 可能前端没有这么高的精度 所以要定义一个配置类JsonConfig来对long进行转换**



#  3. 图片模块
管理员功能： 上传，创建，管理，修改  
用户功能： 查看，搜索，查看详情，下载  
主页的公共图库 都可以进行浏览 图片管理只有管理员可以浏览
主页图库显示的图片都是一样的 但是管理员不会脱敏 用户会脱敏
**目前只有管理员可以上传图片**

**tips：数据库加索引 如果索引varchar类型长度累计和大于2048 就会报错**

图片上传路径不用自己服务器 使用腾讯云的cos对象存储 

**上传图片方案：**  
上传图片时直接保存记录：**在用户上传图片后，系统立即生成图片的完整数据记录**
（包括图片url和其他信息）无需等待用户提交，图片信息就立刻存入数据库，之后用户再填写其他图片信息  
**然后当点击创建按钮 相当于编辑了已有图片记录的信息 便于对图片进行朔源**

上传区分新增和更新两个操作使用saveorupdate （目前只有管理员可以更新图片 更新调用的也是新增接口 但是前台会传这个图片的id 如果图片id有值在数据库 
那么说明是更新操作）

解析图片信息：  
这里使用了腾讯云cos 直接使用**数据万象**服务获取图片基础信息  

**根据腾讯云接口文档编码**  
引入对象存储的依赖cos_api

配置文件CosClientConfig，以及本地用的application-local.yml  
文件上传下载通用类：CosManager 单纯的通过腾讯云提供的api上传下载


**下载图片方案**  
先通过后端服务器进行权限校验  
然后返回给前端一个临时密钥  
之后前端可以凭借密钥直接从对象存储下载，不用经过服务端中转 性能更高

**通用文件上传服务**  
FileManager 包含一些逻辑处理代码









































